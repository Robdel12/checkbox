<html>
  <head>
    <title>Checkbox</title>
    <style>
     .checkbox {
       width: 20px;
       height: 20px;
       border: 1px solid #ddd;
       border-radius: 6px;
       display: inline-block;
       vertical-align: middle;
     }

     .is-checked {
       background-color: #ddd;
     }
    </style>
  </head>
  <body>
    <span tabindex="0"
          id="checkbox"
          class="checkbox">
    </span>
    <label id="checkboxLabel" class="label">
      Isn't this neat?
    </label>

    <script>
     class Checkbox {
       constructor(checkboxEl, labelEl) {
         this.checkbox = checkboxEl;
         this.label = labelEl;

         this.init();
       }

       init() {
         let accessibleNode = this.checkbox.accessibleNode;

         this.checkbox.onclick = this.toggleCheckbox.bind(this);
         this.label.onclick = this.labelClick.bind(this);
         this.checkbox.onkeypress = this.checkboxKeyPress.bind(this);

         //apply accessibile attributes
         accessibleNode.role = 'checkbox';
         accessibleNode.checked = false;
         accessibleNode.labeledBy = new AccessibleNodeList([this.label.accessibleNode]);
       }

       checkboxKeyPress(event) {
         let isEnterOrSpace = event.keyCode === 32 || event.keyCode === 13;

         if(isEnterOrSpace) {
           this.toggleCheckbox();
         }
       }

       labelClick() {
         this.toggleCheckbox();
         this.checkbox.focus();
       }

       toggleCheckbox() {
         let isCurrentlyChecked = this.checkbox.accessibleNode.checked === 'true';

         this.checkbox.classList.toggle('is-checked', !isCurrentlyChecked);
         this.checkbox.accessibleNode.checked = !isCurrentlyChecked;
       }
     }

     let checkboxEl = document.getElementsByClassName('checkbox')[0];
     let labelEl = document.getElementById('checkboxLabel');

     // init new checkbox
     new Checkbox(checkboxEl, labelEl);
    </script>
  </body>
</html>
